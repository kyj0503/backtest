# λ°±μ—”λ“ κ°λ° κ°€μ΄λ“

## μµκ·Ό μ—…λ°μ΄νΈ (2025-09-03)

### π€ Pydantic V2 μ™„μ „ λ§μ΄κ·Έλ μ΄μ…
- **@validator β†’ @field_validator**: λ¨λ“  κ²€μ¦ λ΅μ§ μµμ‹  λ¬Έλ²• μ μ©
- **schema_extra β†’ json_schema_extra**: μ¤ν‚¤λ§ λ¬Έμ„ μƒμ„± ν„λ€ν™”
- **lifespan ν¨ν„΄**: FastAPI on_event λ€μ‹  μµμ‹  lifespan κ΄€λ¦¬ μ μ©
- **Query λ§¤κ°λ³€μ**: regex β†’ pattern λ§¤κ°λ³€μ μ—…λ°μ΄νΈ
- **μ™„μ „ νΈν™μ„±**: λ¨λ“  Pydantic deprecation κ²½κ³  μ κ±°

### π§ ν…μ¤νΈ μ‹μ¤ν… μ™„μ „ μ¬μ„¤κ³„
- **μ™„μ „ μ¤ν”„λΌμΈ λ¨ν‚Ή**: yfinance APIμ™€ MySQL μμ΅΄μ„± μ™„μ „ μ κ±°
- **μν•™μ  λ°μ΄ν„° μƒμ„±**: κΈ°ν• λΈλΌμ΄ μ΄λ™ κΈ°λ° ν„μ‹¤μ  μ£Όμ‹ λ°μ΄ν„° μ‹λ®¬λ μ΄μ…
- **CI/CD μ•μ •μ„±**: μ  ν‚¨μ¤ μ°λ¶„ν¬ ν™κ²½μ—μ„ λ„¤νΈμ›ν¬ μμ΅΄μ„± μ—†λ” ν…μ¤νΈ μ‹¤ν–‰
- **DB μ¤ν‚¤λ§ μ¤€μ**: μ‹¤μ  stock_data_cache ν…μ΄λΈ” κµ¬μ΅°μ™€ μΌμΉν•λ” λ¨μ λ°μ΄ν„°

### οΏ½ μµμ‹  κµ¬ν„ μ™„λ£ κΈ°λ¥
- **μ§„μ§ ν„κΈ μμ‚° μ²λ¦¬**: CASH ν‹°μ»¤ λ¬Έμ  ν•΄κ²°, μ‹¤μ  λ¬΄μ„ν— μμ‚°μΌλ΅ κµ¬ν„
- **μμ‚° νƒ€μ… κµ¬λ¶„**: asset_type ν•„λ“λ΅ ν„κΈκ³Ό μ£Όμ‹ λ…ν™•ν λ¶„λ¦¬
- **ν¬νΈν΄λ¦¬μ¤ μ•μ •μ„±**: ν„κΈ νΌν•© ν¬νΈν΄λ¦¬μ¤μ—μ„ λ¦¬μ¤ν¬ μ™„ν™” κΈ°λ¥ κµ¬ν„

---

## κ°μ”

FastAPI κΈ°λ°μ λ°±ν…μ¤ν… API μ„λ²„μ…λ‹λ‹¤. ν¬νΈν΄λ¦¬μ¤ λ°±ν…μ¤νΈ, ν¬μ μ „λµ μ‹¤ν–‰, μ£Όμ‹ λ°μ΄ν„° κ΄€λ¦¬ κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.

## κΈ°μ  μ¤νƒ

- **ν”„λ μ„μ›ν¬**: FastAPI 0.104+
- **μ–Έμ–΄**: Python 3.11+
- **λ°μ΄ν„° μ²λ¦¬**: pandas, numpy
- **μ£Όμ‹ λ°μ΄ν„°**: yfinance
- **λ°±ν…μ¤ν…**: backtesting.py
- **λ°μ΄ν„°λ² μ΄μ¤**: MySQL

## ν”„λ΅μ νΈ κµ¬μ΅°

```
backend/
β”β”€β”€ app/
β”‚   β”β”€β”€ api/             # API λΌμ°ν„° κ³„μΈµ
β”‚   β”‚   β”β”€β”€ v1/          # v1 API μ—”λ“ν¬μΈνΈ
β”‚   β”‚   β”‚   β””β”€β”€ endpoints/  # κ°λ³„ μ—”λ“ν¬μΈνΈ (backtest, stock, naver_news)
β”‚   β”‚   β”β”€β”€ v2/          # v2 API (ν™•μ¥ μμ •)
β”‚   β”‚   β””β”€β”€ api.py       # κΈ°λ³Έ API λΌμ°ν„°
β”‚   β”β”€β”€ core/            # ν•µμ‹¬ μ„¤μ • λ° μμ™Έ μ²λ¦¬
β”‚   β”β”€β”€ models/          # Pydantic λ¨λΈ (μ”μ²­/μ‘λ‹µ μ¤ν‚¤λ§)
β”‚   β”β”€β”€ services/        # λΉ„μ¦λ‹μ¤ λ΅μ§ (λ°±ν…μ¤νΈ, ν¬νΈν΄λ¦¬μ¤, μ „λµ)
β”‚   β”β”€β”€ utils/           # μ ν‹Έλ¦¬ν‹° (λ°μ΄ν„° μμ§‘, μ§λ ¬ν™”, ν¬νΈν΄λ¦¬μ¤)
β”‚   β””β”€β”€ main.py          # FastAPI μ• ν”λ¦¬μΌ€μ΄μ… μ—”νΈλ¦¬ν¬μΈνΈ
β”β”€β”€ strategies/          # ν¬μ μ „λµ κµ¬ν„μ²΄ (RSI, SMA λ“±)
β”β”€β”€ tests/              # λ°±μ—”λ“ ν…μ¤νΈ μ½”λ“ (μ¬μ„¤κ³„ μ¤‘)
β”‚   β”β”€β”€ conftest.py     # pytest μ„¤μ • λ° μ „μ—­ ν”½μ¤μ²
β”‚   β”β”€β”€ unit/           # λ‹¨μ„ ν…μ¤νΈ (κ³„μΈµλ³„ λ¶„λ¦¬)
β”‚   β”β”€β”€ integration/    # ν†µν•© ν…μ¤νΈ (μ»΄ν¬λ„νΈ κ°„)
β”‚   β”β”€β”€ e2e/           # End-to-End ν…μ¤νΈ (μ „μ²΄ μ‹λ‚λ¦¬μ¤)
β”‚   β””β”€β”€ fixtures/      # λ¨μ λ°μ΄ν„° λ° ν…μ¤νΈ ν”½μ¤μ²
β”‚       β”β”€β”€ mock_data_generator.py  # μν•™μ  μ£Όμ‹ λ°μ΄ν„° μƒμ„±κΈ°
β”‚       β”β”€β”€ stock_metadata.json    # ν…μ¤νΈμ© μ£Όμ‹ λ©”νƒ€λ°μ΄ν„°
β”‚       β””β”€β”€ expected_results.json  # μμƒ λ°±ν…μ¤ν… κ²°κ³Ό
β”β”€β”€ doc/                # λ°±μ—”λ“ κ°λ° λ¬Έμ„
β”β”€β”€ Dockerfile          # λ°±μ—”λ“ λ„μ»¤ μ΄λ―Έμ§€ μ„¤μ •
β””β”€β”€ requirements.txt    # Python μμ΅΄μ„± ν¨ν‚¤μ§€
```

## κ°λ° ν™κ²½ μ„¤μ •

### Docker μ‚¬μ© (κ¶μ¥)

```bash
# ν”„λ΅μ νΈ λ£¨νΈμ—μ„
docker compose -f docker-compose.yml -f docker-compose.dev.yml up backend --build
```

### λ΅μ»¬ κ°λ°

```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**μ£Όμ**: Docker ν™κ²½μ—μ„λ” νΈμ¤νΈ ν¬νΈ 8001λ΅ λ§¤ν•‘λ©λ‹λ‹¤.

## μ£Όμ” κΈ°λ¥

### 1. ν¬νΈν΄λ¦¬μ¤ λ°±ν…μ¤νΈ

ν¬μ κΈμ•΅ κΈ°λ° ν¬νΈν΄λ¦¬μ¤ κµ¬μ„± λ° μ „λµ μ μ©:

```python
# ν¬νΈν΄λ¦¬μ¤ λ°±ν…μ¤νΈ μ”μ²­
{
  "portfolio": [
    {"symbol": "AAPL", "amount": 10000},
    {"symbol": "GOOGL", "amount": 15000}
  ],
  "start_date": "2023-01-01",
  "end_date": "2024-12-31",
  "strategy": "sma_crossover",
  "strategy_params": {
    "short_window": 10,
    "long_window": 20
  }
}
```

### 2. ν¬μ μ „λµ

μ§€μ›ν•λ” μ „λµλ“¤:

- **Buy & Hold**: λ§¤μ ν›„ λ³΄μ  μ „λµ
- **SMA Crossover**: λ‹¨μμ΄λ™ν‰κ·  κµμ°¨ μ „λµ
- **RSI Strategy**: μƒλ€κ°•λ„μ§€μ κΈ°λ° μ „λµ

### 3. λ°μ΄ν„° κ΄€λ¦¬

- yfinanceλ¥Ό ν†µν• μ£Όμ‹ λ°μ΄ν„° μμ§‘
- λ΅μ»¬ μΊμ‹λ¥Ό ν†µν• λΉ λ¥Έ λ°μ΄ν„° μ ‘κ·Ό
- μλ™ λ°μ΄ν„° μ—…λ°μ΄νΈ

## API μ—”λ“ν¬μΈνΈ

μμ„Έν• API λ¬Έμ„λ” [api.md](api.md)λ¥Ό μ°Έμ΅°ν•μ„Έμ”.

### μ£Όμ” μ—”λ“ν¬μΈνΈ

- `POST /api/v1/backtest/portfolio` - ν¬νΈν΄λ¦¬μ¤ λ°±ν…μ¤νΈ
- `POST /api/v1/backtest/chart-data` - μ°¨νΈ λ°μ΄ν„° μ΅°ν

## μƒλ΅μ΄ μ „λµ μ¶”κ°€

1. `strategies/` λ””λ ‰ν„°λ¦¬μ— μƒ μ „λµ νμΌ μƒμ„±
2. `backtesting.Strategy` ν΄λμ¤ μƒμ†
3. `app/services/strategy_service.py`μ— μ „λµ λ“±λ΅

μμ‹:

```python
# strategies/my_strategy.py λλ” app/services/strategy_service.py λ‚΄λ¶€μ— μ§μ ‘ κµ¬ν„
from backtesting import Strategy

class MyStrategy(Strategy):
    # μ „λµ νλΌλ―Έν„° (ν΄λμ¤ λ³€μ)
    param1 = 10
    param2 = 20
    
    def init(self):
        # μ΄κΈ°ν™” λ΅μ§ (μ§€ν‘ κ³„μ‚° λ“±)
        close = self.data.Close
        self.indicator = self.I(SomeIndicator, close, self.param1)
    
    def next(self):
        # λ§¤ λ΄‰λ§λ‹¤ μ‹¤ν–‰λλ” λ§¤λ§¤ λ΅μ§
        if some_condition:
            self.buy()
        elif other_condition:
            self.sell()

# app/services/strategy_service.pyμ _strategies λ”•μ…”λ„λ¦¬μ— λ“±λ΅
_strategies = {
    # κΈ°μ΅΄ μ „λµλ“¤...
    'my_strategy': {
        'class': MyStrategy,
        'parameters': {
            'param1': {'type': 'int', 'default': 10, 'min': 5, 'max': 50},
            'param2': {'type': 'int', 'default': 20, 'min': 10, 'max': 100}
        }
    }
}
```

## λ¬Έμ  ν•΄κ²°

### μμ£Ό λ°μƒν•λ” λ¬Έμ 

1. **μΆ…λ© λ°μ΄ν„° λ΅λ”© μ‹¤ν¨**
   - μΆ…λ© μ‹¬λ³Ό ν™•μΈ (λ€λ¬Έμ μ‚¬μ©)
   - λ„¤νΈμ›ν¬ μ—°κ²° μƒνƒ ν™•μΈ
   - yfinance μ„λΉ„μ¤ μƒνƒ ν™•μΈ

2. **λ°±ν…μ¤νΈ μ‹¤ν–‰ μ¤λ¥**
   - μ „λµ νλΌλ―Έν„° λ²”μ„ ν™•μΈ
   - λ‚ μ§ λ²”μ„ μ ν¨μ„± ν™•μΈ
   - μ¶©λ¶„ν• λ°μ΄ν„° κΈ°κ°„ ν™•μΈ

3. **μ„±λ¥ μ΄μ**
   - λ°μ΄ν„° μΊμ‹ μƒνƒ ν™•μΈ
   - λ©”λ¨λ¦¬ μ‚¬μ©λ‰ λ¨λ‹ν„°λ§
   - DB μ—°κ²° μƒνƒ ν™•μΈ

### λ΅κ·Έ ν™•μΈ

```bash
# Docker ν™κ²½
docker logs backtest-backend-1

# λ΅μ»¬ κ°λ° ν™κ²½
# μ½μ†”μ—μ„ μ§μ ‘ ν™•μΈ κ°€λ¥
```

## κ°λ° μ°Έκ³ μ‚¬ν•­

### μ½”λ“ μ¤νƒ€μΌ

- PEP 8 μ¤€μ
- Type hints μ‚¬μ© κ¶μ¥
- Docstring μ‘μ„± (Google μ¤νƒ€μΌ)

### ν…μ¤νΈ

```bash
# μ „μ²΄ ν…μ¤νΈ μ‹¤ν–‰ (μƒλ΅μ΄ μ¤ν”„λΌμΈ λ¨ν‚Ή μ‹μ¤ν…)
python -m pytest backend/tests/ -v

# κ³„μΈµλ³„ ν…μ¤νΈ μ‹¤ν–‰
python -m pytest backend/tests/unit/ -v           # λ‹¨μ„ ν…μ¤νΈ
python -m pytest backend/tests/integration/ -v   # ν†µν•© ν…μ¤νΈ
python -m pytest backend/tests/e2e/ -v           # E2E ν…μ¤νΈ

# μ»¤λ²„λ¦¬μ§€μ™€ ν•¨κ» μ‹¤ν–‰
python -m pytest backend/tests/ --cov=app --cov-report=html

# Docker ν™κ²½μ—μ„ ν…μ¤νΈ μ‹¤ν–‰
docker-compose -f docker-compose.yml -f docker-compose.dev.yml exec backend pytest tests/ -v
```

**κ°λ° ν™κ²½ μ£Όμμ‚¬ν•­:**
- κ°λ° ν™κ²½μ—μ„λ” λ³Όλ¥¨ λ§μ΄νΈ(`./backend:/app`)λ΅ μΈν•΄ λ΅μ»¬ νμΌ λ³€κ²½ μ‹ μ¦‰μ‹ λ°μλ¨
- μƒλ΅μ΄ ν…μ¤νΈ νμΌ μ¶”κ°€ ν›„μ—λ” μ»¨ν…μ΄λ„ μ¬λΉλ“ ν•„μ”: `docker-compose up --build`
- ν…μ¤νΈ νμΌ μμ •μ€ λ΅μ»¬μ—μ„ ν•κ³ , μ‹¤ν–‰μ€ Docker μ»¨ν…μ΄λ„μ—μ„ ν•λ” κ²ƒμ„ κ¶μ¥

**ν…μ¤νΈ νΉμ§•:**
- **μ™„μ „ μ¤ν”„λΌμΈ**: yfinance API, MySQL μ—°κ²° μ—†μ΄ μ‹¤ν–‰
- **μν•™μ  λ¨μ λ°μ΄ν„°**: κΈ°ν• λΈλΌμ΄ μ΄λ™μΌλ΅ ν„μ‹¤μ  μ£Όκ°€ μƒμ„±
- **CI/CD νΈν™**: μ  ν‚¨μ¤ μ°λ¶„ν¬ ν™κ²½μ—μ„ 100% μ•μ •μ„±
- **DB μ¤ν‚¤λ§ μ¤€μ**: μ‹¤μ  λ°μ΄ν„°λ² μ΄μ¤ κµ¬μ΅°μ™€ λ™μΌν• λ¨μ λ°μ΄ν„°
- **μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ**: bull_market, bear_market, volatile λ“± λ‹¤μ–‘ν• μ‹μ¥ μƒν™©

### λ°°ν¬

ν”„λ΅λ•μ… λ°°ν¬ μ‹ κ³ λ ¤μ‚¬ν•­:

- ν™κ²½ λ³€μ μ„¤μ • (`.env` νμΌ)
- λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ…
- SSL μΈμ¦μ„ μ„¤μ •
- λ΅κ·Έ λ λ²¨ μ΅°μ •

μμ„Έν• λ°°ν¬ κ°€μ΄λ“λ” ν”„λ΅μ νΈ λ£¨νΈμ `README.md`λ¥Ό μ°Έμ΅°ν•μ„Έμ”.

## κ΄€λ ¨ λ¬Έμ„

- **[API κ°€μ΄λ“](./api.md)**: λ°±μ—”λ“ API μ—”λ“ν¬μΈνΈ λ° μ‚¬μ©λ²•
- **[λ„¤μ΄λ²„ λ‰΄μ¤ API](./naver_news_api.md)**: μΆ…λ©λ³„ λ‰΄μ¤ κ²€μƒ‰ κΈ°λ¥
- **[ν…μ¤νΈ μ•„ν‚¤ν…μ²](./TEST_ARCHITECTURE.md)**: λ°±μ—”λ“ ν…μ¤νΈ κµ¬μ΅° λ° λ¨ν‚Ή μ‹μ¤ν…
- **[ν„κΈ μμ‚° μ²λ¦¬](./CASH_ASSETS.md)**: λ¬΄μ„ν— ν„κΈ μμ‚° μ²λ¦¬ λ΅μ§
