# 테스트 전략

본 프로젝트는 코드의 안정성과 신뢰성을 확보하기 위해 계층적 테스트 전략을 채택합니다. 각 테스트 계층은 특정한 목적을 가지며, 이를 통해 효율적이고 포괄적인 테스트 커버리지를 달성하고자 합니다. 우리는 "테스트 피라미드" 모델을 따르며, 빠르고 격리된 **단위 테스트**를 기반으로, 서비스 간의 상호작용을 검증하는 **통합 테스트**, 그리고 실제 사용 시나리오를 모방하는 **E2E 테스트**를 상위에 배치합니다.

## 테스트 계층

### 1. 단위 테스트 (Unit Tests)

-   **위치**: `tests/unit/`
-   **목표**: 가장 작은 코드 단위(함수, 메서드, 클래스)가 예상대로 정확하게 동작하는지 독립적으로 검증합니다.
-   **특징**:
    -   **격리**: 외부 의존성(데이터베이스, 네트워크, 파일 시스템 등)을 모두 모킹(Mocking)합니다.
    -   **속도**: 실행 속도가 매우 빨라 개발 중 수시로 실행하기에 적합합니다.
    -   **범위**: 순수 로직, 계산 함수, 유틸리티, 개별 전략의 핵심 로직(`next` 메서드 등)을 주로 테스트합니다.
-   **Pytest 마커**: `pytest -m unit`

### 2. 통합 테스트 (Integration Tests)

-   **위치**: `tests/integration/`
-   **목표**: 두 개 이상의 모듈이나 서비스가 결합되었을 때 발생하는 문제를 찾아냅니다.
-   **특징**:
    -   **범위**: 서비스 레이어와 리포지토리 레이어의 연동, 특정 API 엔드포인트의 요청/응답 형식, 데이터베이스 트랜잭션(메모리 내 DB 사용) 등을 검증합니다.
    -   **의존성**: 실제 데이터베이스나 외부 API 대신, 테스트용 데이터베이스(예: 인메모리 SQLite)나 모의 서버를 사용하여 제어된 환경에서 테스트합니다.
    -   **속도**: 단위 테스트보다는 느리지만, E2E 테스트보다는 빠릅니다.
-   **Pytest 마커**: `pytest -m integration`

### 3. 종단간 테스트 (End-to-End Tests)

-   **위치**: `tests/e2e/`
-   **목표**: 실제 사용자의 관점에서 전체 시스템이 올바르게 동작하는지 확인합니다.
-   **특징**:
    -   **범위**: API 요청부터 시작하여 서비스 로직, 데이터베이스 접근, 최종 응답 반환까지 전체 흐름을 테스트합니다.
    -   **환경**: 실제 운영 환경과 거의 동일하게 구성된 테스트 환경에서 실행됩니다. (예: Docker Compose로 모든 서비스 실행)
    -   **속도**: 가장 느리고 실행 비용이 크지만, 시스템 전체의 신뢰성을 가장 확실하게 보장합니다.
-   **Pytest 마커**: `pytest -m e2e`

## 테스트 철학

1.  **아래로 갈수록 무겁게**: 테스트 피라미드 원칙에 따라, 빠르고 저렴한 단위 테스트를 가장 많이 작성하고, 느리고 비싼 E2E 테스트는 핵심 시나리오에 대해서만 작성합니다.
2.  **명확한 목적**: 모든 테스트는 "무엇을 검증하는가"가 명확해야 합니다. 테스트 이름과 구조를 통해 의도를 쉽게 파악할 수 있어야 합니다.
3.  **실패는 유용한 정보를 제공해야 한다**: 테스트가 실패했을 때, 어떤 부분이 왜 잘못되었는지 쉽게 파악할 수 있도록 실패 메시지를 명확하게 작성합니다.
4.  **테스트는 독립적이어야 한다**: 각 테스트는 다른 테스트의 결과에 영향을 받아서는 안 되며, 어떤 순서로 실행되어도 동일한 결과를 보장해야 합니다.
